@model IEnumerable<FilmZone.ViewModels.MovieIndexVM>

@{
	if (Model.Any())
	{
		if (Model.All(m => m.CategoryId == Model.First().CategoryId))
		{ ViewData["Title"] = Model.First().Category; }
	}
}

<div class="row mt-5">
	@foreach (var movie in Model)
	{
		<div class="col-lg-4 col-md-6">
			<div class="card text-white rounded-3 overflow-hidden bg-dark mb-3 rounded-1 text-decoration-none"
				 style="max-width: 22rem;">

				<a asp-action="Details"
				   asp-controller="Movies"
				   asp-route-id="@movie.Id"
				   class="text-decoration-none text-white">

					<div class="card-body m-2 rounded-2 position-relative"
						 style="background-image: url('@Url.Content($"~/assets/images/Movies/{movie.Cover}")'); background-size: cover; background-position: center; height: 500px;">

						<!-- 🔖 Watchlist Indicator -->
						@if (movie.InWatchList) // Assuming you have this property in your ViewModel
						{
							<div class="watchlist-indicator position-absolute top-0 start-0 mt-2 ms-2">
								<div class="watchlist-badge">
									<i class="bi bi-bookmark-heart-fill watchlist-icon"></i>
									<div class="watchlist-pulse"></div>
								</div>
							</div>
						}

						<!-- ⭐ Star Rating Overlay -->
						<div class="position-absolute bottom-0 end-0 mb-2 ms-2 me-2 text-warning bg-dark bg-opacity-75 px-2 py-1 rounded">
							@if (movie.Rating.HasValue)
							{
								var rating = movie.Rating.Value;
								for (int i = 1; i <= 5; i++)
								{
									if (i <= (int)rating)
									{
										<i class="bi bi-star-fill"></i>
									}
									else if (i == (int)rating + 1 && rating % 1 >= 0.5)
									{
										<i class="bi bi-star-half"></i>
									}
									else
									{
										<i class="bi bi-star"></i>
									}
								}
							}
							else
							{
								@* No rating yet — show empty stars *@
								for (int i = 1; i <= 5; i++)
								{
									<i class="bi bi-star"></i>
								}
							}
							@if (movie.Rating.HasValue)
							{
								var rounded = Math.Floor(movie.Rating.Value * 10) / 10;
								<span>@rounded.ToString("0.0")</span>
							}
						</div>
					</div>

					<div class="card-footer py-0 px-2">
						<h5>@movie.Title</h5>

						<div style="display: flex; flex-wrap: wrap; gap: 8px; padding-top: 2px;">
							@foreach (var StreamLogo in movie.StreamingLogos)
							{
								<img src="@Url.Content($"~/assets/images/Logos/{StreamLogo}.png")"
									 alt="@StreamLogo"
									 class="stream-logo me-2 fs-4 mb-2" />
							}
						</div>
					</div>
				</a>

				<a asp-action="Index"
				   asp-route-id="@movie.CategoryId"
				   class="badge rounded-pill bg-light fs-6 ms-3 mt-n3 position-absolute category-badge"
				   style="bottom: 105px;z-index: 10; text-decoration: none;">
					@movie.Category
				</a>
			</div>
		</div>
	}
</div>

<style>
	/* Watchlist Indicator Styles */
	.watchlist-indicator {
		z-index: 15;
		pointer-events: none;
	}

	.watchlist-badge {
		position: relative;
		background: linear-gradient(135deg, #ff6b6b 0%, #ff5722 100%);
		border: 2px solid #fff;
		border-radius: 50%;
		width: 40px;
		height: 40px;
		display: flex;
		align-items: center;
		justify-content: center;
		box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4), 0 0 20px rgba(255, 107, 107, 0.3);
		animation: watchlistGlow 2s ease-in-out infinite alternate;
	}

	.watchlist-icon {
		font-size: 1.2rem;
		color: #fff;
		filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.8));
	}

	.watchlist-pulse {
		position: absolute;
		top: -2px;
		left: -2px;
		right: -2px;
		bottom: -2px;
		border: 2px solid #ff6b6b;
		border-radius: 50%;
		animation: watchlistPulse 2s ease-in-out infinite;
		opacity: 0;
	}

	@@keyframes watchlistGlow {
		0% {
			box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4), 0 0 20px rgba(255, 107, 107, 0.3);
		}

		100% {
			box-shadow: 0 4px 20px rgba(255, 107, 107, 0.6), 0 0 30px rgba(255, 107, 107, 0.5);
		}
	}

	@@keyframes watchlistPulse {
		0% {
			transform: scale(1);
			opacity: 0.7;
		}

		100% {
			transform: scale(1.3);
			opacity: 0;
		}
	}

	/* Enhanced card hover effect for watchlisted movies */
	.card:has(.watchlist-indicator):hover {
		transform: scale(1.05) !important;
		box-shadow: 0 0 20px rgba(255, 107, 107, 0.4), 0 0 40px rgba(0, 180, 255, 0.3), 0 8px 30px rgba(0, 0, 0, 0.3) !important;
		border-color: rgba(255, 107, 107, 0.5) !important;
	}

	/* Original styles */
	.category-badge {
		transition: box-shadow 0.4s ease, background-color 0.3s ease;
		background-color: #0d6efd;
		color: white;
		cursor: pointer;
		text-decoration: none;
	}

		.category-badge:hover {
			box-shadow: 0 0 12px 4px #0d6efd;
			background-color: #0b5ed7;
		}

	.stream-logo {
		width: 32px;
		height: 32px;
		border-radius: 6px;
		transition: transform 0.2s ease, box-shadow 0.2s ease;
	}

		.stream-logo:hover {
			transform: scale(1.1);
			box-shadow: 0 0 12px rgba(0, 0, 0, 0.9);
		}

	.card {
		transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
		box-shadow: 0 0 8px rgba(0, 0, 0, 0.4);
		border: 1px solid rgba(255, 255, 255, 0.05);
	}

		.card:hover {
			transform: scale(1.03);
			box-shadow: 0 0 16px rgba(0, 180, 255, 0.5), 0 0 32px rgba(0, 120, 255, 0.3);
			border-color: rgba(0, 120, 255, 0.5);
			z-index: 5;
		}

		/* Category-specific glow colors on hover */
		.card[data-category="Action"]:hover {
			box-shadow: 0 0 16px rgba(255, 0, 0, 0.5), 0 0 32px rgba(255, 0, 0, 0.3);
			border-color: rgba(255, 0, 0, 0.4);
		}

		.card[data-category="Drama"]:hover {
			box-shadow: 0 0 16px rgba(155, 89, 182, 0.5), 0 0 32px rgba(142, 68, 173, 0.3);
			border-color: rgba(142, 68, 173, 0.4);
		}

		.card[data-category="SciFi"]:hover {
			box-shadow: 0 0 16px rgba(0, 255, 255, 0.5), 0 0 32px rgba(0, 255, 255, 0.3);
			border-color: rgba(0, 255, 255, 0.4);
		}
</style>